var __reflect=this&&this.__reflect||function(t,e,n){t.__class__=e,n?n.push(e):n=[e],t.__types__=t.__types__?n.concat(t.__types__):n},__extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},__assign=this&&this.__assign||Object.assign||function(t){for(var e,n=1,i=arguments.length;i>n;n++){e=arguments[n];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},__awaiter=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))(function(r,a){function s(t){try{h(i.next(t))}catch(e){a(e)}}function o(t){try{h(i["throw"](t))}catch(e){a(e)}}function h(t){t.done?r(t.value):new n(function(e){e(t.value)}).then(s,o)}h((i=i.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(t){return function(e){return i([t,e])}}function i(n){if(r)throw new TypeError("Generator is already executing.");for(;h;)try{if(r=1,a&&(s=a[2&n[0]?"return":n[0]?"throw":"next"])&&!(s=s.call(a,n[1])).done)return s;switch(a=0,s&&(n=[0,s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,a=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===n[0]||2===n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(i){n=[6,i],a=0}finally{r=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}var r,a,s,o,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return o={next:n(0),"throw":n(1),"return":n(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,n){function i(i){e.call(n,i,t)}if(RES.hasRes(t)){var r=RES.getRes(t);r?i(r):RES.getResAsync(t,i,this)}else RES.getResByUrl(t,i,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.animal=["a","b","c","d","e","f","g","h","i"],e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=300,this.textField.width=480,this.textField.height=100,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e.prototype.randomSeat=function(t){for(var e=this,n=new Set;n.size<t;)n.add(this.animal[Math.floor(Math.random()*this.animal.length)]);for(var i=Array.from(n),r=0;r<i.length;r++);this.animalSeats=new Array(9),i.forEach(function(t){var n=Math.floor(Math.random()*e.animalSeats.length);e.animalSeats[n]&&(n=e.animalSeats.findIndex(function(t){return!t})),e.animalSeats[n]=t});var a=-1;do a=this.animalSeats.findIndex(function(t){return!t}),this.animalSeats[a]=i[Math.floor(Math.random()*i.length)];while(-1!=a);console.log(this.animalSeats)},e.prototype.getConditionList=function(){},e.prototype.getAnimalsSeatObj=function(){var t=this;this.animalSeatsObj={},this.animalSeats.forEach(function(e,n){t.animalSeatsObj[e]||(t.animalSeatsObj[e]=[]),t.animalSeatsObj[e].push(n)})},e.prototype.intersect=function(){for(var t=new Array,e={},n=0;n<arguments.length;n++)for(var i=0;i<arguments[n].length;i++){var r=arguments[n][i];e[r]?(e[r]++,e[r]==arguments.length&&t.push(r)):e[r]=1}return t},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,platform.login()];case 2:return e.sent(),[4,platform.getUserInfo()];case 3:return t=e.sent(),console.log(t),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,4,,5]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return n.sent(),[4,this.loadTheme()];case 2:return n.sent(),[4,RES.loadGroup("preload",0,t)];case 3:return n.sent(),this.stage.removeChild(t),[3,5];case 4:return e=n.sent(),console.error(e),[3,5];case 5:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,n){var i=new eui.Theme("resource/default.thm.json",t.stage);i.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.createGameScene=function(){var t=this;this.btnGroup=new eui.Group,this.btnGroup.width=this.stage.stageWidth,this.btnGroup.height=this.stage.stageHeight,this.addChild(this.btnGroup),this.scoreLabel=new eui.Label,this.scoreLabel.text="0",this.scoreLabel.size=40,this.scoreLabel.right=80,this.addChild(this.scoreLabel),this.lineShape=new egret.Sprite,this.lineShape.touchEnabled=!0,this.lineShape.width=this.stage.stageWidth,this.lineShape.height=this.stage.stageHeight,this.addChild(this.lineShape);var e=new eui.Button;this.addChild(e),e.alpha=0,e.width=this.stage.stageWidth,e.height=this.stage.stageHeight,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.onBegin,this),e.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.onMove,this),e.addEventListener(egret.TouchEvent.TOUCH_END,this.onEnd,this),this.startGameBtn=new eui.Button,this.startGameBtn.label="开始游戏",this.startGameBtn.horizontalCenter=0,this.startGameBtn.bottom=100,this.addChild(this.startGameBtn),this.startGameBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){t.startGame()},this)},e.prototype.onBegin=function(t){this.lineShape.graphics.clear(),this.lastPoint=new egret.Point(t.localX,t.localY),this.pointTrails=[{x:t.localX,y:t.localY}]},e.prototype.onMove=function(t){this.lineShape.graphics.lineStyle(3,16777215),this.lineShape.graphics.moveTo(this.lastPoint.x,this.lastPoint.y),this.lineShape.graphics.lineTo(t.localX,t.localY),this.lastPoint.x=t.localX,this.lastPoint.y=t.localY,this.pointTrails.push({x:t.localX,y:t.localY})},e.prototype.onEnd=function(t){this.lastPoint=null;var e=this.checkLine();console.log("画的是：",e),this.checkBtnList(e)},e.prototype.checkIsStraightLine=function(t,e){if(null===t||void 0===t||t.length<3)return!1;for(var n=t[0].x,i=t[0].y,r=t[t.length-1].x,a=t[t.length-1].y,s=this.atan(r-n,a-i),o=5;o<t.length;o++){var h=this.atan(t[o].x-t[o-4].x,t[o].y-t[o-4].y);if(Math.abs(h-s)>e)return!1}return!0},e.prototype.checkLine=function(){var t=this.pointTrails[0].x,e=this.pointTrails[0].y,n=this.pointTrails[this.pointTrails.length-1].x,i=this.pointTrails[this.pointTrails.length-1].y,r=this.atan(n-t,i-e);return this.checkIsStraightLine(this.pointTrails,30)?Math.abs(r)<10?"-":90-Math.abs(r)<10?"|":60>r&&r>30?"\\":-30>r&&r>-60?"/":"other line":this.checkIsX()},e.prototype.checkIsX=function(){var t=this.pointTrails[0].x,e=(this.pointTrails[0].y,this.pointTrails[this.pointTrails.length-1].x),n=(this.pointTrails[this.pointTrails.length-1].y,0),i=this.pointTrails[0],r=this.pointTrails[0];if(this.pointTrails.forEach(function(t,e){t.x>r.x&&(r=__assign({},t,{index:e})),t.x<i.x&&(i=__assign({},t,{index:e}))}),i.x!=t&&i.x!=e?n=i.index:r.x!=t&&r.x!=e&&(n=r.index),n&&Math.abs(i.x-r.x)>100){var a=this.pointTrails.slice(0,n),s=this.pointTrails.slice(n,this.pointTrails.length-1);if(this.checkIsStraightLine(a,60)&&this.checkIsStraightLine(s,60))return n==i.index?"<":n==r.index?">":""}return"other"},e.prototype.atan=function(t,e){return 180*Math.atan(e/t)/Math.PI},e.prototype.startGame=function(){this.btnList=[],this.btnGroup.removeChildren(),this.startGameBtn.visible=!1,this.addAround(20)},e.prototype.addAround=function(t){var e=this;t&&(this.addBtnToGroup(),t-=1,this.timeoutId=egret.setTimeout(function(){e.addAround(t)},this,2e3))},e.prototype.addBtnToGroup=function(){var t=this,e=["-","\\","/","|","<",">"],n=new eui.Button,i=new eui.Button;n.width=i.width=this.stage.stageWidth/3,n.x=this.stage.stageWidth/9,i.x=this.stage.stageWidth/9*5,n.height=i.height=80,n.label=i.label="";for(var r=0;r<Math.floor(4*Math.random())+1;r++)n.label+=e[Math.floor(6*Math.random())];for(var r=0;r<Math.floor(4*Math.random())+1;r++)i.label+=e[Math.floor(6*Math.random())];this.btnGroup.addChild(n),this.btnGroup.addChild(i),this.btnList.push(n,i),egret.Tween.get(n).to({y:this.stage.stageHeight-80},20*this.stage.stageHeight).call(function(){t.gameOver()}),egret.Tween.get(i).to({y:this.stage.stageHeight-80},20*this.stage.stageHeight).call(function(){t.gameOver()})},e.prototype.gameOver=function(){console.log("game over");var t=new eui.Label;t.text="game over",t.size=60,t.horizontalCenter=0,t.verticalCenter=0,t.scaleX=t.scaleY=0,this.addChild(t),egret.Tween.get(t).to({scaleX:1,scaleY:1},500),egret.clearTimeout(this.timeoutId),egret.Tween.removeAllTweens(),this.btnGroup.removeChildren(),this.startGameBtn.visible=!0},e.prototype.checkBtnList=function(t){var e=this;this.btnList.forEach(function(n){var i=n.label.split("")[0];i==t&&(e.scoreLabel.text=(5+ +e.scoreLabel.text).toString(),n.label=n.label.substr(1)),n.label||egret.Tween.get(n).to({alpha:0},500).call(function(){egret.Tween.removeTweens(n),n.parent&&n.parent.removeChild(n)})}),this.btnList.length||(this.startGameBtn.visible=!0),egret.setTimeout(function(){e.lineShape.graphics.clear()},this,300)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,n,i){function r(t){e.call(i,t)}function a(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),n.call(i))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(i,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,n){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(i,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var o=t.split("/");o.pop();var h=o.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(i,generateJSON.paths[t])},this):RES.getResByUrl(h,function(n){window.JSONParseClass.setData(n),egret.callLater(function(){e.call(i,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(i,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,a,null),RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);